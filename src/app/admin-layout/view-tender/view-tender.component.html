<div class="main-content">

    <mat-toolbar color="primary">

        <mat-toolbar-row>            
            <div>
                <button mat-button (click)="addLineItem()">Add Line Item</button>
                <button mat-button (click)="notify()">Invite Sub Contractors</button>     
            </div>
        </mat-toolbar-row>
    </mat-toolbar>


    <div class="table-responsive">
        <form [formGroup]="masterForm" *ngIf="masterForm">
            <div formArrayName="items">
                <table class="table table-bordered">
                    <!-- <caption class="section"><textarea type="text" class="form-control watermain"
                            appAutoAdjust></textarea>
                    </caption> -->
                    <thead class=" text-primary">
                        <th>
                            Select
                        </th>
                        <th>
                            Item No
                        </th>
                        <th>
                            Spec No
                        </th>
                        <th>
                            Item Name
                        </th>

                        <th>
                            Description
                        </th>
                        <th>
                            Unit
                        </th>
                        <th>
                            Quantity
                        </th>
                        <th>
                            Unit Price
                        </th>
                        <th>
                            Actions
                        </th>

                    </thead>

                    <tbody>
                        <ng-container *ngFor="let item of masterForm.get('items').controls; let i = index"
                            [formGroupName]="i">

                            <tr>
                                <td class="width-2 text-center">
                                    <div class="form-check">
                                        <label class="form-check-label">
                                            <input class="form-check-input" type="checkbox" value="" checked>
                                            <span class="form-check-sign">
                                                <span class="check"></span>
                                            </span>
                                        </label>
                                    </div>
                                </td>

                                <td class="width-2"><textarea type="text" class="form-control" appAutoAdjust
                                        formControlName="itemNo"></textarea></td>
                                <td class="width-10"><textarea type="text" class="form-control" appAutoAdjust
                                        name="specNo" formControlName="specNo"></textarea></td>
                                <td class="width-20"><textarea type="text" class="form-control" appAutoAdjust
                                        name="specNo" formControlName="itemName"></textarea></td>
                                <td class="width-25"><textarea type="text" class="form-control" appAutoAdjust
                                        formControlName="description"></textarea></td>
                                <td class="width-2"><textarea type="text" class="form-control" appAutoAdjust name="unit"
                                        formControlName="unit"></textarea>
                                </td>
                                <td class="width-5"><textarea type="text" class="form-control" appAutoAdjust
                                        name="quantity" formControlName="quantity"></textarea></td>
                                <td class="width-5"><textarea type="text" class="form-control" appAutoAdjust
                                        name="unitPrice" formControlName="unitPrice"></textarea></td>

                                <td class="td-actions width-15">
                                    <button mat-raised-button type="button" matTooltip="view"
                                        [matTooltipPosition]="'above'" (click)="viewer(item)"
                                        class="btn btn-primary btn-link btn-sm btn-just-icon">
                                        <i class="material-icons">remove_red_eye</i>
                                    </button>
                                    <button mat-raised-button type="button" matTooltip="remove"
                                        [matTooltipPosition]="'above'" (click)="delete(item)"
                                        class="btn btn-danger btn-link btn-sm btn-just-icon">
                                        <i class="material-icons">close</i>
                                    </button>
                                    <button mat-raised-button type="button" *ngIf="!accordion[i]"
                                        matTooltip="expand" (click)="toggleCollapse(i)"
                                        [matTooltipPosition]="'above'"
                                        class="btn btn-danger btn-link btn-sm btn-just-icon">
                                        <i class="material-icons">expand_more</i>
                                    </button>
                                    <button mat-raised-button type="button" *ngIf="accordion[i]" matTooltip="less"
                                        (click)="toggleCollapse(i)" [matTooltipPosition]="'above'"
                                        class="btn btn-danger btn-link btn-sm btn-just-icon">
                                        <i class="material-icons">expand_less</i>
                                    </button>
                                </td>
                            </tr>

                            <tr [ngbCollapse]="!accordion[i]">
                                <td colspan="9" class="collapse-body">

                                    <ngb-accordion #acc="ngbAccordion" activeIds="ngb-panel-0">
                                        <ngb-panel>
                                            <ng-template ngbPanelTitle>
                                                <p> <span class="title">SubLine Items</span></p>
                                            </ng-template>
                                            <ng-template ngbPanelContent>
                                                <table class="table table-condensed">
                                                    <thead>
                                                        <th>Name</th>
                                                        <th>Unit</th>
                                                        <th>Unit Price</th>
                                                        <th>Quantity</th>
                                                        <th>Total Price</th>
                                                        <th>
                                                            <a mat-button class="nav-link" data-toggle="tab" (click)="addSubLineItem(item)">
                                                                <i class="material-icons">add</i>
                                                            </a>
                                                        </th>
                                                    </thead>

                                                    <tbody>
                                                        <ng-container formArrayName="subitems">
                                                            <tr *ngFor="let sItem of item.get('subitems').controls; let sInd = index;"
                                                                [formGroupName]="sInd">

                                                                <td>
                                                                    <textarea type="text" class="form-control"
                                                                        appAutoAdjust formControlName="name"></textarea>
                                                                </td>
                                                                <td>
                                                                    <textarea type="text" class="form-control"
                                                                        appAutoAdjust formControlName="unit"></textarea>
                                                                </td>
                                                                <td>
                                                                    <textarea type="text" class="form-control"
                                                                        appAutoAdjust
                                                                        formControlName="unitPrice"></textarea>
                                                                </td>
                                                                <td>
                                                                    <textarea type="text" class="form-control"
                                                                        appAutoAdjust
                                                                        formControlName="quantity"></textarea>
                                                                </td>
                                                                <td>
                                                                    <textarea type="text" class="form-control"
                                                                        appAutoAdjust
                                                                        formControlName="totalPrice"></textarea>
                                                                </td>
                                                                <td class="td-actions width-10">
                                                                    <button mat-raised-button type="button"
                                                                        matTooltip="Remove"
                                                                        [matTooltipPosition]="'above'"
                                                                        class="btn btn-danger btn-link btn-sm btn-just-icon"
                                                                        (click)="removeSublineItem(item, sInd)">
                                                                        <i class="material-icons">close</i>
                                                                    </button>
                                                                </td>

                                                            </tr>
                                                        </ng-container>
                                                    </tbody>
                                                </table>
                                            </ng-template>
                                        </ngb-panel>

                                        <!-- <ngb-panel>
                    <ng-template ngbPanelTitle>
                        <span class="title">Trench Calculation</span>
                    </ng-template>
                    <ng-template ngbPanelContent>
                        <div class="row justify-content-center align-items-center">
                            <div class="col-auto">
                                <div class="form-group">
                                    <label for="typeahead-focus">Search for
                                        CREW:</label>
                                    <input id="typeahead-focus" type="text" class="typeahead" formControlName="crew"
                                        (selectItem)="selectedItem($event,item)"
                                        [ngbTypeahead]="searchFunctionFactory(instance)"
                                        (focus)="focus$.next($event.target.value)"
                                        (click)="click$.next($event.target.value)" #instance="ngbTypeahead" />
                                    <span *ngIf="searching">searching...</span>
                                    <div class="invalid-feedback" *ngIf="searchFailed">
                                        Sorry, suggestions could not be loaded.
                                    </div>
                                </div>

                            </div>
                        </div>
                        <table class="table table-borderless">
                            <tbody>
                                <tr>
                                    <td>
                                        <table class="table table-striped table-bordered">
                                            <caption>BACKFILL</caption>
                                            <tr>
                                                <td>
                                                    LENGTH
                                                </td>
                                                <td>
                                                    <textarea type="text" class="form-control"
                                                        (keyup)="calculateTrench()" appAutoAdjust
                                                        [(ngModel)]="trench.backfill.length">
                                                       </textarea>
                                            </tr>

                                            <tr>
                                                <td>
                                                    HEIGHT
                                                </td>
                                                <td>
                                                    <textarea type="text" class="form-control"
                                                        (keyup)="calculateTrench()" appAutoAdjust
                                                        [(ngModel)]="trench.backfill.height">
                                                       </textarea>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td>
                                                    WIDTH
                                                </td>
                                                <td>
                                                    <textarea type="text" class="form-control"
                                                        (keyup)="calculateTrench()" appAutoAdjust
                                                        [(ngModel)]="trench.backfill.width">
                                                       </textarea>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    Volume
                                                </td>
                                                <td>
                                                    <textarea type="text" class="form-control"
                                                        (keyup)="calculateTrench()" appAutoAdjust
                                                        [(ngModel)]="trench.backfill.boxVolume">
                                                       </textarea>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td>
                                                    DENSITY
                                                </td>
                                                <td>
                                                    <textarea type="text" class="form-control"
                                                        (keyup)="calculateTrench()" appAutoAdjust
                                                        [(ngModel)]="trench.backfill.density">
                                                       </textarea>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    WEIGHT
                                                </td>
                                                <td>
                                                    <textarea type="text" class="form-control"
                                                        (keyup)="calculateTrench()" appAutoAdjust
                                                        [(ngModel)]="trench.backfill.weight">
                                                       </textarea>
                                                </td>
                                            </tr>
                                        </table>

                                    </td>
                                    <td>
                                        <table class="table table-striped table-bordered">
                                            <caption>Beading</caption>
                                            <tbody>
                                                <tr>
                                                    <td>Length</td>
                                                    <td>
                                                        <textarea type="text" class="form-control"
                                                            (keyup)="calculateTrench()" appAutoAdjust
                                                            [(ngModel)]="trench.backfill.length">
                                                       </textarea>
                                                    </td>
                                                </tr>

                                                <tr>
                                                    <td>Height</td>
                                                    <td> <textarea type="text" class="form-control"
                                                            (keyup)="calculateTrench()" appAutoAdjust
                                                            [(ngModel)]="trench.beading.height">
                                                       </textarea></td>
                                                </tr>

                                                <tr>
                                                    <td>Width</td>
                                                    <td> <textarea type="text" class="form-control"
                                                            (keyup)="calculateTrench()" appAutoAdjust
                                                            [(ngModel)]="trench.backfill.width">
                                                       </textarea></td>
                                                </tr>

                                                <tr>
                                                    <td>Box Volume</td>
                                                    <td> <textarea type="text" class="form-control"
                                                            (keyup)="calculateTrench()" appAutoAdjust
                                                            [(ngModel)]="trench.beading.boxVolume">
                                                       </textarea></td>
                                                </tr>
                                                <tr>
                                                    <td>Diameter</td>
                                                    <td> <textarea type="text" class="form-control"
                                                            (keyup)="calculateTrench()" appAutoAdjust
                                                            [(ngModel)]="trench.beading.diameter">
                                                       </textarea></td>
                                                </tr>
                                                <tr>
                                                    <td>Pipe Volume</td>
                                                    <td> <textarea type="text" class="form-control"
                                                            (keyup)="calculateTrench()" appAutoAdjust
                                                            [(ngModel)]="trench.beading.pipeVolume">
                                                       </textarea></td>
                                                </tr>
                                                <tr>
                                                    <td>Density</td>
                                                    <td> <textarea type="text" class="form-control"
                                                            (keyup)="calculateTrench()" appAutoAdjust
                                                            [(ngModel)]="trench.beading.density">
                                                       </textarea></td>
                                                </tr>

                                                <tr>
                                                    <td>Weight</td>
                                                    <td> <textarea type="text" class="form-control"
                                                            (keyup)="calculateTrench()" appAutoAdjust
                                                            [(ngModel)]="trench.beading.weight">
                                                       </textarea></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </td>
                                    <td class="trench-calculation">
                                        <div class="section" style="text-align:center;">

                                            =cube section start= 
                                            <div class="cube" style="margin:auto;">
                                                <div class="front" [ngStyle]="{'width':trench.backfill.length+'px'}">
                                                    <div class="lower"
                                                        [ngStyle]="{'width':trench.backfill.length+'px'}">
                                                        <div class="left-dimension">
                                                            <p class="rotate">100m</p>
                                                        </div>

                                                        <div class="top-dimension">
                                                            <p>100m</p>
                                                        </div>
                                                        <div class="image-circle">
                                                            100
                                                        </div>
                                                    </div>
                                                    <div class="upper"
                                                        [ngStyle]="{'width':trench.backfill.length+'px'}">
                                                        <div class="left-dimension">
                                                            <p class="rotate">
                                                                {{this.trench.backfill.height}}
                                                            </p>
                                                        </div>

                                                        <div class="top-dimension">
                                                            <p>{{this.trench.backfill.length}}
                                                            </p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="back" [ngStyle]="{'width':trench.backfill.length+'px'}">
                                                    <div class="upper"
                                                        [ngStyle]="{'width':trench.backfill.length+'px'}">
                                                        <div class="left-dimension">
                                                            <p class="rotate">
                                                                {{this.trench.backfill.height}}
                                                            </p>
                                                        </div>

                                                        <div class="top-dimension">
                                                            <p>{{this.trench.backfill.length}}
                                                            </p>
                                                        </div>

                                                    </div>
                                                    <div class="lower"
                                                        [ngStyle]="{'width':trench.backfill.length+'px'}">
                                                        <div class="left-dimension">
                                                            <p class="rotate">100m</p>
                                                        </div>

                                                        <div class="top-dimension">
                                                            <p>100m</p>
                                                        </div>
                                                        <div class="image-circle">

                                                        </div>
                                                    </div>

                                                </div>
                                                <div class="top" [ngStyle]="{'width':trench.backfill.length+'px'}">
                                                </div>
                                                <div class="bottom" [ngStyle]="{'width':trench.backfill.length+'px'}">

                                                </div>
                                                <div class="left">
                                                    <div class="upper">BACKFILL
                                                        <div class="left-dimension">
                                                            <p class="rotate">
                                                                {{trench.backfill.height}}</p>
                                                        </div>

                                                        <div class="top-dimension">
                                                            <p>{{trench.backfill.width}}</p>
                                                        </div>
                                                    </div>
                                                    <div class="lower">BEDDING
                                                        <div class="left-dimension">
                                                            <p class="rotate">100m</p>
                                                        </div>

                                                        <div class="top-dimension">
                                                            <p>100m</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="right"
                                                    [ngStyle]="{'left':(trench.backfill.length*1)-100+'px'}">
                                                    <div class="upper">
                                                        <div class="left-dimension">
                                                            <p class="rotate">
                                                                {{this.trench.backfill.height}}
                                                            </p>
                                                        </div>

                                                        <div class="top-dimension">
                                                            <p>{{this.trench.backfill.width}}
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <div class="lower">
                                                        <div class="left-dimension">
                                                            <p class="rotate">100m</p>
                                                        </div>

                                                        <div class="top-dimension">
                                                            <p>100m</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </ng-template>
                </ngb-panel> -->

                                    
                                    </ngb-accordion>
                                </td>
                            </tr>
                        </ng-container>
                        <tr>
                            <td colspan="7" class="text-right">Total</td>
                            <td colspan="2" class="text-left">5000</td>
                        </tr>
                    </tbody>

                </table>

            </div>
        </form>
    </div>




</div>
